flinkVersion: "1.18"

image:
  repository: yourorg/flink-job
  tag: latest

serviceAccount:
  name: flink

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9249"
  prometheus.io/path: "/metrics"

flinkConfiguration:
  taskmanager.numberOfTaskSlots: "4"
  state.backend.type: rocksdb
  state.backend.incremental: "true"
  state.checkpoints.dir: "s3://flink-checkpoints/telemetry/"
  execution.checkpointing.interval: "60s"
  execution.checkpointing.mode: EXACTLY_ONCE
  execution.checkpointing.timeout: "2min"
  restart-strategy.type: failure-rate
  restart-strategy.failure-rate.max-failures-per-interval: "3"
  restart-strategy.failure-rate.failure-rate-interval: "5min"
  restart-strategy.failure-rate.delay: "10s"
  metrics.reporter.prom.class: org.apache.flink.metrics.prometheus.PrometheusReporter
  metrics.reporter.prom.port: 9249

jobManager:
  replicas: 1
  resources:
    requests:
      cpu: "2"
      memory: "4Gi"
    limits:
      cpu: "4"
      memory: "6Gi"

taskManager:
  replicas: 4
  resources:
    requests:
      cpu: "4"
      memory: "8Gi"
    limits:
      cpu: "6"
      memory: "12Gi"

job:
  jarURI: local:///opt/flink/usrlib/telemetry.jar
  entryClass: com.telemetry.flink.MainJob
  parallelism: 16
  upgradeMode: savepoint

env:
  KAFKA_BOOTSTRAP_SERVERS: kafka-cluster-kafka-bootstrap.kafka:9092
  SCHEMA_REGISTRY_URL: http://schema-registry.kafka:8081
  POSTGRES_HOST: postgres.control-api
  POSTGRES_PORT: "5432"
  REDIS_HOST: redis.control-api
  REDIS_PORT: "6379"
  S3_BUCKET: telemetry-data
  S3_ENDPOINT: http://minio:9000